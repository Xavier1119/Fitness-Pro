<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness Pro Tracker</title>
    <style>
        :root {
            /* --- å¼·åˆ¶é è¨­ï¼šæ˜äº®æ¨¡å¼ (White Theme) --- */
            --bg-color: #ffffff;      /* 1. æœ€åº•å±¤ï¼šç´”ç™½èƒŒæ™¯ (ç¶­æŒä¸è®Š) */
            --card-bg: #e0e0e0;       /* 2. å¡ç‰‡å€å¡Šï¼šæ”¹ç‚ºè¼ƒæ·±çš„ç°è‰² (åŸç‚ºå¾ˆæ·ºçš„ #f2f2f7) */
            --text-main: #000000;     /* ç´”é»‘å­— */
            --text-sec: #666666;      /* æ¬¡è¦æ–‡å­—ç¨å¾®èª¿æ·±ä¸€é»ä»¥é©æ‡‰æ–°èƒŒæ™¯ */
            --input-bg: #ffffff;      /* è¼¸å…¥æ¡†ç¶­æŒç™½è‰²ï¼Œåœ¨æ·±ç°å¡ç‰‡ä¸Šå°æ¯”æ›´å¼· */
            
            /* å¼·èª¿è‰² (å¯è®Šæ›´) */
            --accent-color: #800020;  /* é è¨­é…’ç´… */
            --delete-bg: #ff3b30;     /* åˆªé™¤ç´… */
            
            --radius: 20px;
            --btn-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* --- æ·±è‰²æ¨¡å¼ (Dark Mode) --- */
        body.dark-mode {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --text-main: #ffffff;
            --text-sec: #98989d;
            --input-bg: #2c2c2e;
        }
        
        /* --- åˆå¤œæ¨¡å¼ (Midnight) --- */
        body.midnight-mode {
            --bg-color: #0f172a;      /* æ·±è—åº• */
            --card-bg: #1e293b;       /* è—ç°å¡ç‰‡ */
            --text-main: #f8fafc;
            --text-sec: #94a3b8;
            --input-bg: #0f172a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none; /* é˜²æ­¢é•·æŒ‰é¸å–æ–‡å­—å½±éŸ¿æ»‘å‹•é«”é©— */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px; /* æ‰‹æ©Ÿç‰ˆé‚Šè· */
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        .container {
            width: 100%;
            max-width: 500px;
            padding-bottom: 50px; /* åº•éƒ¨ç•™ç™½ */
        }

        /* --- Header å€åŸŸ --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 5px;
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 800;
            cursor: text;
            border-bottom: 1px dashed transparent;
        }
        .header-title h1:focus {
            border-bottom-color: var(--text-sec);
            outline: none;
        }
        .header-title p {
            font-size: 12px;
            color: var(--text-sec);
        }

        /* è¨­å®šæŒ‰éˆ• (æ˜é¡¯çš„é½’è¼ª) */
        .settings-btn {
            background: var(--card-bg);
            border: 1px solid rgba(0,0,0,0.05);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .settings-btn:active { transform: scale(0.9); }

        /* --- å¡è·¯é‡Œé¡¯ç¤º --- */
        .cal-display {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }
        .cal-tag {
            background: var(--card-bg);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-sec);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .cal-tag strong {
            color: var(--accent-color);
            font-size: 16px;
        }

        /* --- è¨­å®šé¢æ¿ (é è¨­éš±è—) --- */
        #settings-panel {
            display: none;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            animation: slideDown 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .theme-row {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        .theme-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--text-sec);
            background: transparent;
            color: var(--text-main);
            border-radius: 10px;
            font-size: 12px;
            opacity: 0.6;
        }
        .theme-btn.active {
            opacity: 1;
            border-color: var(--accent-color);
            background: var(--input-bg);
            font-weight: bold;
            color: var(--accent-color);
        }

        .color-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            position: relative;
        }
        .color-dot.active::after {
            content: 'âœ“'; color: #fff;
            position: absolute; left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }

        /* --- é€šç”¨å¡ç‰‡ --- */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
        }
        .card h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--text-main);
            opacity: 0.8;
        }

        /* --- è¼¸å…¥èˆ‡æŒ‰éˆ• --- */
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
        
        .input-group { margin-bottom: 12px; }
        label {
            display: block;
            font-size: 11px;
            color: var(--text-sec);
            margin-bottom: 5px;
            padding-left: 5px;
        }
        
        input, select {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid transparent;
            padding: 14px;
            border-radius: 16px;
            font-size: 15px;
            color: var(--text-main);
            outline: none;
            /* è®“è¼¸å…¥æ¡†åœ¨ç°åº•ä¸Šæµ®ç¾ */
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
        }
        input:focus, select:focus {
            border-color: var(--accent-color);
        }

        /* ä¸»æŒ‰éˆ• */
        .btn-main {
            width: 100%;
            background: var(--accent-color);
            color: #fff;
            border: none;
            padding: 16px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.98); }

        /* --- åˆ—è¡¨èˆ‡å·¦æ»‘åˆªé™¤æ ¸å¿ƒ CSS --- */
        .log-wrapper {
            position: relative;
            height: 75px;
            margin-bottom: 12px;
            border-radius: 18px;
            overflow: hidden; 
            /* èƒŒæ™¯è¨­ç‚ºç´…è‰²ï¼Œç•¶ä¸Šé¢çš„å¡ç‰‡æ»‘é–‹æ™‚ï¼Œå°±æœƒçœ‹åˆ°é€™å€‹ç´…è‰² */
            background-color: var(--delete-bg); 
        }

        .delete-btn-area {
            position: absolute;
            right: 0;
            top: 0;
            width: 80px; /* å°æ‡‰æ»‘å‹•çš„æœ€å¤§è·é›¢ */
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        
        .trash-icon {
            font-size: 24px;
            color: white;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ°ä¸‹é¢çš„ click handler */
        }

        .log-item {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--card-bg); /* è“‹åœ¨ç´…è‰²ä¸Šé¢çš„å¡ç‰‡ */
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 2;
            /* é—œéµï¼šä½¿ç”¨ transform ç§»å‹• */
            transform: translateX(0);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            will-change: transform;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .log-left h3 { font-size: 15px; margin-bottom: 4px; }
        .log-detail { font-size: 12px; color: var(--text-sec); }
        .log-detail span { 
            background: var(--input-bg); 
            padding: 2px 6px; border-radius: 4px; margin-right: 5px; 
        }

        /* --- ä¸‹æ‹‰é¸å–®å°æ¨™é¡Œä¿®é£¾ --- */
        optgroup { color: var(--accent-color); }
        
    </style>
</head>
<body>

<div class="container">
    
    <header>
        <div class="header-title">
            <h1 id="app-title" contenteditable="true" spellcheck="false">Fitness Pro</h1>
            <p>Today's Workout</p>
        </div>
        <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
    </header>

    <div id="settings-panel">
        <label>ä¸»é¡Œé¢¨æ ¼</label>
        <div class="theme-row">
            <button class="theme-btn active" onclick="setTheme('light', this)">æ˜äº®ç™½</button>
            <button class="theme-btn" onclick="setTheme('dark', this)">ç§‘æŠ€é»‘</button>
            <button class="theme-btn" onclick="setTheme('midnight', this)">åˆå¤œè—</button>
        </div>
        <label>ä¸»é¡Œé¡è‰²</label>
        <div class="theme-row" style="justify-content: space-between;">
            <div class="color-dot" style="background:#800020;" onclick="setColor('#800020', this)"></div>
            <div class="color-dot" style="background:#007aff;" onclick="setColor('#007aff', this)"></div>
            <div class="color-dot" style="background:#34c759;" onclick="setColor('#34c759', this)"></div>
            <div class="color-dot" style="background:#5856d6;" onclick="setColor('#5856d6', this)"></div>
            <div class="color-dot" style="background:#ff9500;" onclick="setColor('#ff9500', this)"></div>
        </div>
    </div>

    <div class="cal-display">
        <div class="cal-tag">
            ä»Šæ—¥æ¶ˆè€—ï¼š<strong id="cal-count">0</strong> KCAL
        </div>
    </div>

    <div class="card">
        <h2>å€‹äººåŸºæœ¬è³‡æ–™</h2>
        <div class="row">
            <div class="col input-group">
                <label>èº«é«˜ (cm)</label>
                <input type="number" id="height" onchange="saveProfile()">
            </div>
            <div class="col input-group">
                <label>é«”é‡ (kg)</label>
                <input type="number" id="weight" onchange="saveProfile()">
            </div>
            <div class="col input-group">
                <label>å¹´é½¡</label>
                <input type="number" id="age" onchange="saveProfile()">
            </div>
        </div>
    </div>

    <div class="card">
        <h2>æ–°å¢ç´€éŒ„</h2>
        <div class="input-group">
            <label>è¨“ç·´å‹•ä½œ</label>
            <select id="exercise-select">
                <option value="" disabled selected>é¸æ“‡å‹•ä½œ...</option>
                </select>
        </div>
        <div class="row">
            <div class="col input-group">
                <label>çµ„æ•¸</label>
                <input type="number" id="sets" placeholder="4">
            </div>
            <div class="col input-group">
                <label>é‡é‡/æ¬¡æ•¸</label>
                <input type="text" id="reps" placeholder="ä¾‹å¦‚: 50kg x 10">
            </div>
        </div>
        <div class="input-group">
            <label>å‚™è¨» (é¸å¡«)</label>
            <input type="text" id="notes" placeholder="ç‹€æ³å¦‚ä½•ï¼Ÿ">
        </div>
        <button class="btn-main" onclick="addLog()">+ åŠ å…¥è¨“ç·´</button>
    </div>

    <div class="card" style="padding-bottom: 10px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <h2>ä»Šæ—¥æ¸…å–®</h2>
            <span style="font-size:12px; color:var(--text-sec); cursor:pointer;" onclick="clearToday()">æ¸…é™¤å…¨éƒ¨</span>
        </div>
        
        <div id="log-list">
            </div>
    </div>

</div>

<script>
    /* --- 1. è³‡æ–™åº«èˆ‡è¨­å®š --- */
    const STORAGE_KEY = 'fitness_pro_v6'; // æ›´æ–°ç‰ˆæœ¬è™Ÿä»¥é‡ç½®æ¨£å¼
    
    // é è¨­è³‡æ–™ (å¼·åˆ¶ Light Mode)
    let appData = {
        title: "Fitness Pro",
        theme: { mode: 'light', color: '#800020' },
        profile: { height: '', weight: '', age: '' },
        logs: []
    };

    const exerciseDB = {
        "èƒ¸éƒ¨ (Chest)": [ {n:"æ§“éˆ´è‡¥æ¨",c:15}, {n:"å•éˆ´è‡¥æ¨",c:15}, {n:"ä¼åœ°æŒºèº«",c:8}, {n:"å¤¾èƒ¸",c:10} ],
        "èƒŒéƒ¨ (Back)": [ {n:"å¼•é«”å‘ä¸Š",c:15}, {n:"æ»‘è¼ªä¸‹æ‹‰",c:12}, {n:"åˆ’èˆ¹",c:15}, {n:"ç¡¬èˆ‰",c:25} ],
        "è…¿éƒ¨ (Legs)": [ {n:"æ·±è¹²",c:20}, {n:"è…¿æ¨èˆ‰",c:18}, {n:"åˆ†è…¿è¹²",c:15} ],
        "è‚©éƒ¨ (Shoulders)": [ {n:"è‚©æ¨",c:12}, {n:"å´å¹³èˆ‰",c:8}, {n:"å‰å¹³èˆ‰",c:8} ],
        "æ‰‹è‡‚ (Arms)": [ {n:"äºŒé ­å½èˆ‰",c:8}, {n:"ä¸‰é ­ä¸‹å£“",c:8} ],
        "æ ¸å¿ƒ (Core)": [ {n:"æ²è…¹",c:5}, {n:"æ£’å¼",c:5} ]
    };

    /* --- 2. åˆå§‹åŒ– --- */
    window.onload = function() {
        initExerciseMenu();
        loadData();
        setupTitleEditor();
    };

    function initExerciseMenu() {
        const sel = document.getElementById('exercise-select');
        for (let cat in exerciseDB) {
            let grp = document.createElement('optgroup');
            grp.label = cat;
            exerciseDB[cat].forEach(ex => {
                let opt = document.createElement('option');
                opt.value = ex.n;
                opt.textContent = ex.n;
                opt.dataset.cal = ex.c;
                grp.appendChild(opt);
            });
            sel.appendChild(grp);
        }
    }

    function loadData() {
        const json = localStorage.getItem(STORAGE_KEY);
        if (json) {
            appData = { ...appData, ...JSON.parse(json) };
        }
        // å¥—ç”¨è³‡æ–™
        document.getElementById('app-title').innerText = appData.title;
        document.getElementById('height').value = appData.profile.height;
        document.getElementById('weight').value = appData.profile.weight;
        document.getElementById('age').value = appData.profile.age;
        
        // å¥—ç”¨ä¸»é¡Œ
        setTheme(appData.theme.mode);
        setColor(appData.theme.color);
        
        renderLogs();
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
    }

    /* --- 3. ä¸»é¡Œæ§åˆ¶ --- */
    function toggleSettings() {
        const p = document.getElementById('settings-panel');
        p.style.display = (p.style.display === 'block') ? 'none' : 'block';
    }

    function setTheme(mode, btn) {
        appData.theme.mode = mode;
        document.body.className = (mode === 'light') ? '' : (mode + '-mode');
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        if (btn) {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        } else {
            // åˆå§‹åŒ–æ™‚æ‰¾å°æ‡‰æŒ‰éˆ•
            const map = {'light':0, 'dark':1, 'midnight':2};
            const btns = document.querySelectorAll('.theme-btn');
            if(btns[map[mode]||0]) btns[map[mode]||0].classList.add('active');
        }
        saveData();
    }

    function setColor(color, btn) {
        appData.theme.color = color;
        document.documentElement.style.setProperty('--accent-color', color);
        
        if(btn) {
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            btn.classList.add('active');
        }
        saveData();
    }

    function setupTitleEditor() {
        document.getElementById('app-title').addEventListener('input', function() {
            appData.title = this.innerText;
            saveData();
        });
    }
    
    function saveProfile() {
        appData.profile.height = document.getElementById('height').value;
        appData.profile.weight = document.getElementById('weight').value;
        appData.profile.age = document.getElementById('age').value;
        saveData();
    }

    /* --- 4. ç´€éŒ„èˆ‡å¡è·¯é‡Œ --- */
    function addLog() {
        const sel = document.getElementById('exercise-select');
        const opt = sel.options[sel.selectedIndex];
        if (!opt || opt.disabled) return alert("è«‹é¸æ“‡å‹•ä½œ");
        
        const sets = document.getElementById('sets').value || 0;
        const reps = document.getElementById('reps').value || '';
        const cal = (sets * (opt.dataset.cal || 10));

        appData.logs.unshift({
            id: Date.now(),
            date: new Date().toLocaleDateString(),
            time: new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),
            ex: opt.value,
            sets: sets,
            reps: reps,
            cal: cal,
            note: document.getElementById('notes').value
        });
        
        saveData();
        renderLogs();
        // æ¸…ç©º
        document.getElementById('notes').value = '';
    }

    function renderLogs() {
        const list = document.getElementById('log-list');
        const today = new Date().toLocaleDateString();
        const logs = appData.logs.filter(l => l.date === today);
        
        // æ›´æ–°å¡è·¯é‡Œ
        const total = logs.reduce((a,b) => a + (b.cal||0), 0);
        document.getElementById('cal-count').innerText = total;

        list.innerHTML = '';
        if (logs.length === 0) {
            list.innerHTML = '<div style="text-align:center;color:var(--text-sec);padding:20px;font-size:13px;">å°šç„¡ç´€éŒ„</div>';
            return;
        }

        logs.forEach(log => {
            const wrap = document.createElement('div');
            wrap.className = 'log-wrapper';
            
            // åˆªé™¤æŒ‰éˆ•å€ (åº•å±¤)
            const delArea = document.createElement('div');
            delArea.className = 'delete-btn-area';
            delArea.innerHTML = '<span class="trash-icon">ğŸ—‘ï¸</span>';
            delArea.onclick = function() { deleteLog(log.id); };

            // å¡ç‰‡ (ä¸Šå±¤)
            const item = document.createElement('div');
            item.className = 'log-item';
            item.innerHTML = `
                <div class="log-left">
                    <h3>${log.ex}</h3>
                    <div class="log-detail">
                        <span>${log.sets}çµ„</span>
                        <span>${log.reps}</span>
                    </div>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:12px;color:var(--text-sec);">${log.time}</div>
                    <div style="font-size:12px;color:var(--accent-color);">${log.note||''}</div>
                </div>
            `;

            // ç¶å®šæ»‘å‹•é‚è¼¯
            bindSwipeLogic(item, log.id);

            wrap.appendChild(delArea);
            wrap.appendChild(item);
            list.appendChild(wrap);
        });
    }

    /* --- 5. å·¦æ»‘é‚è¼¯ (æ ¸å¿ƒä¿®æ­£) --- */
    function bindSwipeLogic(el, id) {
        let startX = 0;
        let currentX = 0;
        let isDragging = false;
        const MAX_SWIPE = -80; 
        let autoCloseTimer = null;

        // è§¸æ§é–‹å§‹
        el.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            isDragging = true;
            el.style.transition = 'none'; 
            if (autoCloseTimer) clearTimeout(autoCloseTimer);
        }, {passive:true});

        // è§¸æ§ç§»å‹•
        el.addEventListener('touchmove', e => {
            if (!isDragging) return;
            currentX = e.touches[0].clientX;
            let diff = currentX - startX;
            if (diff < 0) {
                let move = Math.max(diff, MAX_SWIPE); 
                el.style.transform = `translateX(${move}px)`;
            }
        }, {passive:true});

        // è§¸æ§çµæŸ
        el.addEventListener('touchend', e => {
            isDragging = false;
            el.style.transition = 'transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)';
            const diff = currentX - startX;
            if (diff < -50) {
                el.style.transform = `translateX(${MAX_SWIPE}px)`;
                autoCloseTimer = setTimeout(() => { el.style.transform = 'translateX(0)'; }, 5000);
            } else {
                el.style.transform = 'translateX(0)';
            }
        });

        // é›»è…¦ç‰ˆæ»‘é¼ æ”¯æ´
        el.addEventListener('mousedown', e => {
            startX = e.clientX;
            isDragging = true;
            el.style.transition = 'none';
            if (autoCloseTimer) clearTimeout(autoCloseTimer);
        });
        window.addEventListener('mousemove', e => {
            if(!isDragging) return;
            let diff = e.clientX - startX;
            if(diff < 0) el.style.transform = `translateX(${Math.max(diff, MAX_SWIPE)}px)`;
        });
        window.addEventListener('mouseup', e => {
            if(!isDragging) return;
            isDragging = false;
            el.style.transition = 'transform 0.3s';
            let diff = e.clientX - startX;
            if (diff < -50) {
                el.style.transform = `translateX(${MAX_SWIPE}px)`;
                autoCloseTimer = setTimeout(() => { el.style.transform = 'translateX(0)'; }, 5000);
            } else {
                el.style.transform = 'translateX(0)';
            }
        });
        
        el.addEventListener('click', () => {
             el.style.transform = 'translateX(0)';
        });
    }

    function deleteLog(id) {
        if(navigator.vibrate) navigator.vibrate(50);
        appData.logs = appData.logs.filter(l => l.id !== id);
        saveData();
        renderLogs();
    }

    function clearToday() {
        const today = new Date().toLocaleDateString();
        if (confirm("ç¢ºå®šåˆªé™¤ä»Šæ—¥æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
            appData.logs = appData.logs.filter(l => l.date !== today);
            saveData();
            renderLogs();
        }
    }
</script>

</body>
</html>